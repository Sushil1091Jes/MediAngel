!function(){"use strict";function e(){this.filterResults={},this.filterLimit=20}e.prototype.bindEventHandlers=function(){var a=this;$("#filter-categoriesTemplate .clear").on("click",function(){$("#filter-categoriesTemplate .key").val(""),a.filter(""),a.resetForm()}),$("#filter-categoriesTemplate form").submit(function(){var e=$("#filter-categoriesTemplate .key").val();return $(".selected").removeClass("selected"),a.resetForm(),a.filter(e),!1}),$(document).on("click",".categoryTemplate-row",function(){var t,e;$("#filter-categoriesTemplate .filter").prop("disabled")?$("#filter-categoriesTemplate .results").css("color","#AAA"):($("#categories_template").find(".record-details").show(),t=$(this).attr("data-id"),e=a.filterResults.find(function(e){return Number(e.id)===Number(t)}),a.display(e),$("#filter-categoriesTemplate .selected").removeClass("selected"),$(this).addClass("selected"),$("#edit-categoryTemplate, #delete-categoryTemplate").prop("disabled",!1))}),$("#add-categoryTemplate").on("click",function(){a.resetForm(),$("#categories_template .add-edit-delete-group").hide(),$("#categories_template .save-cancel-group").show(),$("#categories_template .record-details").find("input, select, textarea").prop("disabled",!1),$("#filter-categoriesTemplate button").prop("disabled",!0),$("#filter-categoriesTemplate .results").css("color","#AAA")}),$("#edit-categoryTemplate").on("click",function(){$("#categories_template .add-edit-delete-group").hide(),$("#categories_template .save-cancel-group").show(),$("#categories_template .record-details").find("input, select, textarea").prop("disabled",!1),$("#filter-categoriesTemplate button").prop("disabled",!0),$("#filter-categoriesTemplate .results").css("color","#AAA")}),$("#delete-categoryTemplate").on("click",function(){var e=$("#categoryTemplate-id").val(),t=[{text:EALang.cancel,click:function(){$("#message-box").dialog("close")}},{text:EALang.delete,click:function(){a.delete(e),$("#message-box").dialog("close")}}];GeneralFunctions.displayMessageBox(EALang.delete_category,EALang.delete_record_prompt,t)}),$("#save-categoryTemplate").on("click",function(){var e={name:$("#categoryTemplate-name").val()};""!==$("#categoryTemplate-id").val()&&(e.id=$("#categoryTemplate-id").val()),a.validate()&&a.save(e)}),$("#cancel-categoryTemplate").on("click",function(){var e=$("#categoryTemplate-id").val();a.resetForm(),""!==e&&a.select(e,!0)})},e.prototype.filter=function(t,a,r){var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_filter_service_categories_template";$("#categories_template").find(".record-details").hide();var i={csrfToken:GlobalVariables.csrfToken,key:t,limit:this.filterLimit};$.post(e,i).done(function(e){this.filterResults=e,$("#filter-categoriesTemplate .results").empty(),e.forEach(function(e){$("#filter-categoriesTemplate .results").append(this.getFilterHtml(e)).append($("<hr/>"))}.bind(this)),0===e.length?$("#filter-categoriesTemplate .results").append($("<em/>",{text:EALang.no_records_found})):e.length===this.filterLimit&&$("<button/>",{type:"button",class:"btn btn-block btn-outline-secondary load-more text-center",text:EALang.load_more,click:function(){this.filterLimit+=20,this.filter(t,a,r)}.bind(this)}).appendTo("#filter-categoriesTemplate .results"),a&&this.select(a,r)}.bind(this)).fail(GeneralFunctions.ajaxFailureHandler)},e.prototype.save=function(e){var t=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_service_category_template",a={csrfToken:GlobalVariables.csrfToken,category_template:JSON.stringify(e)};$.post(t,a).done(function(e){Backend.displayNotification(EALang.service_category_template_saved),this.resetForm(),$("#filter-categoriesTemplate .key").val(""),this.filter("",e.id,!0),BackendServices.updateAvailableCategories()}.bind(this)).fail(GeneralFunctions.ajaxFailureHandler)},e.prototype.delete=function(e){var t=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_service_category_template",a={csrfToken:GlobalVariables.csrfToken,category_template_id:e};$.post(t,a).done(function(){Backend.displayNotification(EALang.service_category_template_deleted),this.resetForm(),this.filter($("#filter-categoriesTemplate .key").val()),BackendServices.updateAvailableCategories()}.bind(this)).fail(GeneralFunctions.ajaxFailureHandler)},e.prototype.display=function(e){$("#categoryTemplate-id").val(e.id),$("#categoryTemplate-name").val(e.name),$("#categoryTemplate-image").attr("src",e.image)},e.prototype.validate=function(){$("#categoriestemplate .has-error").removeClass("has-error"),$("#categoriestemplate .form-message").removeClass("alert-danger").hide();try{var a=!1;if($("#categoriestemplate .required").each(function(e,t){$(t).val()||($(t).closest(".form-group").addClass("has-error"),a=!0)}),a)throw new Error(EALang.fields_are_required);return!0}catch(e){return $("#categoriestemplate .form-message").addClass("alert-danger").text(e.message).show(),!1}},e.prototype.resetForm=function(){$("#filter-categoriesTemplate .selected").removeClass("selected"),$("#filter-categoriesTemplate button").prop("disabled",!1),$("#filter-categoriesTemplate .results").css("color",""),$("#categories_template .add-edit-delete-group").show(),$("#categories_template .save-cancel-group").hide(),$("#categories_template .record-details").find("input, select, textarea").val("").prop("disabled",!0),$("#edit-categoryTemplate, #delete-categoryTemplate").prop("disabled",!0),$("#categories_template .record-details .has-error").removeClass("has-error"),$("#categories_template .record-details .form-message").hide(),$("#categoryTemplate-image").attr("src","")},e.prototype.getFilterHtml=function(e){return $("<div/>",{class:"categoryTemplate-row entry","data-id":e.id,html:[$("<strong/>",{text:e.name}),$("<br/>")]})},e.prototype.select=function(t,e){var a;e=e||!1,$("#filter-categoriesTemplate .selected").removeClass("selected"),$('#filter-categoriesTemplate .categoryTemplate-row[data-id="'+t+'"]').addClass("selected"),e&&(a=this.filterResults.find(function(e){return Number(e.id)===Number(t)}.bind(this)),this.display(a),$("#edit-categoriestemplate, #delete-categoriestemplate").prop("disabled",!1))},window.CategoriesTemplateHelper=e}();
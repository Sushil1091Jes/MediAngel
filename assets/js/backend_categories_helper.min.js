!function(){"use strict";function e(){this.filterResults={},this.filterCategoriesTemplateResults={},this.filterLimit=20}e.prototype.bindEventHandlers=function(){var r=this;$("#filter-categories .clear").on("click",function(){$("#filter-categories .key").val(""),r.filter(""),r.resetForm()}),$("#filter-categories form").submit(function(){var e=$("#filter-categories .key").val();return $(".selected").removeClass("selected"),r.resetForm(),r.filter(e),!1}),$(document).on("click",".category-row",function(){var t,e;$("#filter-categories .filter").prop("disabled")?$("#filter-categories .results").css("color","#AAA"):(t=$(this).attr("data-id"),e=r.filterResults.find(function(e){return Number(e.id)===Number(t)}),r.display(e),$("#filter-categories .selected").removeClass("selected"),$(this).addClass("selected"),$("#edit-category, #delete-category").prop("disabled",!1))}),$("#add-category").on("click",function(){r.resetForm(),$("#categories .add-edit-delete-group").hide(),$("#categories .save-cancel-group").show(),$("#categories .record-details").find("input, select, textarea").prop("disabled",!1),$("#filter-categories button").prop("disabled",!0),$("#filter-categories .results").css("color","#AAA"),$(".record-details button").prop("disabled",!1)}),$("#edit-category").on("click",function(){$("#categories .add-edit-delete-group").hide(),$("#categories .save-cancel-group").show(),$("#categories .record-details").find("input, select, textarea").prop("disabled",!1),$("#filter-categories button").prop("disabled",!0),$("#filter-categories .results").css("color","#AAA"),$(".record-details button").prop("disabled",!1)}),$("#delete-category").on("click",function(){var e=$("#category-id").val(),t=[{text:EALang.cancel,click:function(){$("#message-box").dialog("close")}},{text:EALang.delete,click:function(){r.delete(e),$("#message-box").dialog("close")}}];GeneralFunctions.displayMessageBox(EALang.delete_category,EALang.delete_record_prompt,t)}),$("#save-category").on("click",function(){var e;r.validate()&&(e={name:$("#category-name").val(),description:$("#category-description").val(),image:$("#category-image").val()},""!==$("#category-id").val()&&(e.id=$("#category-id").val()),r.uploadFileAndSave(e))}),$("#cancel-category").on("click",function(){var e=$("#category-id").val();r.resetForm(),""!==e&&r.select(e,!0)}),$("#insert-categoriestemplate").on("click",function(){r.categoriesTemplateGetHtml(),$("#manage-categoriestemplate").modal("show")}),$("#confirm-categoriestemplate").on("click",function(){var t,e,a=$("#manage-categoriestemplate").find("input[type=checkbox]:checked");0<a.length&&(t=a.parents("tr").eq(0).attr("data-id"),e=r.filterCategoriesTemplateResults.find(function(e){return Number(e.id)===Number(t)}),$("#category-name").val(e.name),$("#category-image").val(e.image),$("#uploaded_image").attr("src",e.image));var i=$("#manage-categoriestemplate");i.find(".alert").addClass("d-none"),i.modal("hide")}),$("#manage-categoriestemplate").on("click",".categories_template_row",function(){"checkbox"!=event.target.type&&($(this).find("input[type='checkbox']").prop("checked")?$(this).find("input[type='checkbox']").prop("checked",!1):$(this).find("input[type='checkbox']").prop("checked",!0),$(this).find("input[type='checkbox']").trigger("change"));for(var e=$(this).attr("data-id"),t=$("input[name='categoryTemplateCheckbox']"),a=0;a<t.length;a++){e!=$(t[a]).parents("tr").attr("data-id")&&$(t[a]).prop("checked")&&$(t[a]).prop("checked",!1)}})},e.prototype.filter=function(t,a,i){var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_filter_service_categories",r={csrfToken:GlobalVariables.csrfToken,key:t,limit:this.filterLimit};$.post(e,r).done(function(e){this.filterResults=e,$("#filter-categories .results").empty(),e.forEach(function(e){$("#filter-categories .results").append(this.getFilterHtml(e)).append($("<hr/>"))}.bind(this)),0===e.length?$("#filter-categories .results").append($("<em/>",{text:EALang.no_records_found})):e.length===this.filterLimit&&$("<button/>",{type:"button",class:"btn btn-block btn-outline-secondary load-more text-center",text:EALang.load_more,click:function(){this.filterLimit+=20,this.filter(t,a,i)}.bind(this)}).appendTo("#filter-categories .results"),a&&this.select(a,i)}.bind(this)).fail(GeneralFunctions.ajaxFailureHandler)},e.prototype.save=function(e){var t=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_service_category",a={csrfToken:GlobalVariables.csrfToken,category:JSON.stringify(e)};$.post(t,a).done(function(e){Backend.displayNotification(EALang.service_category_saved),this.resetForm(),$("#filter-categories .key").val(""),this.filter("",e.id,!0),BackendServices.updateAvailableCategories()}.bind(this)).fail(GeneralFunctions.ajaxFailureHandler)},e.prototype.delete=function(e){var t=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_service_category",a={csrfToken:GlobalVariables.csrfToken,category_id:e};$.post(t,a).done(function(){Backend.displayNotification(EALang.service_category_deleted),this.resetForm(),this.filter($("#filter-categories .key").val()),BackendServices.updateAvailableCategories()}.bind(this)).fail(GeneralFunctions.ajaxFailureHandler)},e.prototype.display=function(e){$("#category-id").val(e.id),$("#category-name").val(e.name),$("#category-description").val(e.description),$("#category-image").val(""),$("#uploaded_image").attr("src","./../../assets/img/user.png"),e.image&&($("#category-image").val(e.image),$("#uploaded_image").attr("src",e.image))},e.prototype.validate=function(){$("#categories .has-error").removeClass("has-error"),$("#categories .form-message").removeClass("alert-danger").hide();try{var a=!1;if(null==$("#upload_image")[0].files[0]&&(""===$("#category-image").val()||null===$("#category-image").val()))throw new Error(EALang.image_upload);if($("#categories .required").each(function(e,t){$(t).val()||($(t).closest(".form-group").addClass("has-error"),a=!0)}),a)throw new Error(EALang.fields_are_required);return!0}catch(e){return $("#categories .form-message").addClass("alert-danger").text(e.message).show(),!1}},e.prototype.resetForm=function(){$("#filter-categories .selected").removeClass("selected"),$("#filter-categories button").prop("disabled",!1),$("#filter-categories .results").css("color",""),$("#categories .add-edit-delete-group").show(),$("#categories .save-cancel-group").hide(),$("#categories .record-details").find("input, select, textarea").val("").prop("disabled",!0),$("#edit-category, #delete-category").prop("disabled",!0),$("#categories .record-details .has-error").removeClass("has-error"),$("#categories .record-details .form-message").hide(),$("#uploaded_image").attr("src","./../../assets/img/user.png"),$("#insert-categoriestemplate").prop("disabled",!0)},e.prototype.getFilterHtml=function(e){return $("<div/>",{class:"category-row entry","data-id":e.id,html:[$("<strong/>",{text:e.name}),$("<br/>")]})},e.prototype.select=function(t,e){var a;e=e||!1,$("#filter-categories .selected").removeClass("selected"),$('#filter-categories .category-row[data-id="'+t+'"]').addClass("selected"),e&&(a=this.filterResults.find(function(e){return Number(e.id)===Number(t)}.bind(this)),this.display(a),$("#edit-category, #delete-category").prop("disabled",!1))},e.prototype.uploadFileAndSave=function(t){var e=GlobalVariables.baseUrl+"/application/upload/upload_fileBase64.php",a=new FormData;if(null!=$("#upload_image")[0].files[0]){var i=this;a.append("upload_image",$("#uploaded_image").attr("src"));try{$.ajax({type:"POST",url:e,data:a,async:!0,contentType:!1,processData:!1,dataType:"json",success:function(e){if(""==e.file)throw new Error(EALang.image_upload_error);$("#category-image").val(e.file),$("#upload_image").val(""),t.image=e.file,i.save(t)}})}catch(e){$("#providers .form-message").addClass("alert-danger").text(e.message).show()}}else this.save(t)},e.prototype.filterCategoriesTemplate=function(e,t,a){var i=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_filter_service_categories_template",r={csrfToken:GlobalVariables.csrfToken,key:e,limit:this.filterLimit};$("#insert-categoriestemplate").hide(),$.post(i,r).done(function(e){0<(this.filterCategoriesTemplateResults=e).length&&$("#insert-categoriestemplate").show()}.bind(this)).fail(GeneralFunctions.ajaxFailureHandler)},e.prototype.categoriesTemplateGetHtml=function(){$("#manage-categoriestemplate .modal-body").find("table").empty();var t="<tr><th style='width:15%'><div></div></th><th><div>"+EALang.name+"</div></th><th><div>"+EALang.image+"</div></th> </tr >",e=this.filterCategoriesTemplateResults;0===e.length?t+="<tr><td colspan='3'><div>"+EALang.no_records_found+"</div></td></tr >":e.forEach(function(e){t+="<tr class='categories_template_row' data-id='"+e.id+"' >",t+="<td><input type='checkbox' name='categoryTemplateCheckbox'></input></td >",t+="<td> <div>"+e.name+"</div></td >",t+="<td  align='center' valign='middle'> <div><img  src='"+e.image+"' class='img - responsive' style='width: 100px; height: 100px;'></div></td >",t+="</tr>"}),$("#manage-categoriestemplate .modal-body").find("table").html(t)},window.CategoriesHelper=e}();